<!DOCTYPE HTML>
<head>

  <script src="support.js"> </script>
  <script src="kernel.js"> </script>

  <script src="../parts/js/hello.js"> </script>
  <script src="../parts/js/world.js"> </script>
  <script src="../parts/js/string-join.js"> </script>


  <script src="run.js"> </script>

<script> 
function display (text) {
   document.getElementById ('output').textContent=text; 
}

var top_schematic = "";

function load_recursively (text) {
display (text);
    let top_schem = ""
    let obj = JSON.parse (text); 
    obj.forEach ( item => {
console.log (item.name);
	kindTable[item.name] = item;
	if (item.itemKind === "graph") {
	    // parts are emitted in reverse order
	    // - top schematic is the last part emitted
	    top_schem = item.name;  // overwrite, leaving top-most schematic
	}
    });
    display ("TOP = " + top_schem);
    top_schematic = top_schem;
}
</script>

</head>

<body>
   <input type="file" name="inputfile" id="inputfile"> 
   <hr> 

<script type="text/javascript">
        document.getElementById('inputfile') 
            .addEventListener('change', function () { 
            var fr = new FileReader (); 
            fr.onload = function (){ 
                var text = fr.result;
                load_recursively (text);
console.log ('running : ' + top_schematic); 
console.log ('kindTable : ' + kindTable[top_schematic]); 
                kindTable[top_schematic] ();
            } 
            fr.readAsText (this.files[0]); 
        }) 
</script>

    <div id="output"></div>
</body>
</html>
